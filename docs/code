<!DOCTYPE html>
<html>
<head>
  <title>AES</title>
  <style>
    body {background-color: #000;}
    
    input[type="file"]::file-selector-button {
      font-size: 25px;
      color: #000;
      background-color: #F0F0F0;
      cursor: pointer;
      padding: 20px 20px;
      border-radius: 12px;
    }

    input[type="file"] {
      color: #ffffff;
      font-size: 25px;
      width: 600px;
      position: absolute;
      top: 270px;
      left: 50%;
      transform: translateX(-50%);
    }

    h1 {
      color: #ffffff;
      text-align: center;
      font-size: 58px;
    }

    .encrypt-button {
      font-size: 70px;
      color: white;
      background-color: #404040;
      border-radius: 85px;
      border-width: 0.1ch;
      cursor: pointer;
      padding: 40px 250px;
      position: absolute;
      top: 500px;
      left: 50%;
      transform: translateX(-50%);
    }

    .decrypt-button {
      font-size: 70px;
      color: white;
      background-color: #404040;
      border-radius: 85px;
      border-width: 0.1ch;
      cursor: pointer;
      padding: 40px 250px;
      position: absolute;
      top: 800px;
      left: 50%;
      transform: translateX(-50%);
    }

    .encrypt-button:hover, .decrypt-button:hover {
      background-color: #000;
    }

  </style>
</head>
<body>
  <h1>Advanced Encryption Standard</h1>
  <input type="file" id="fileInput" class="choose-file-button">
  <button class="encrypt-button" onclick="encryptFile()">Encrypt</button>
  <button class="decrypt-button" onclick="decryptFile()">Decrypt</button>
  <p id="status"></p>

  <script>
    const password = "password";

    async function encryptFile() {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];

      const fileData = await readFile(file);
      const encryptedData = await encryptData(fileData);

      const encryptedBlob = new Blob([encryptedData], { type: file.type });
      const encryptedFileName = `${file.name}.encrypted`;
      downloadBlob(encryptedBlob, encryptedFileName);

      document.getElementById('status').innerText = "Encryption complete!";
    }

    async function decryptFile() {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];

      const fileData = await readFile(file);
      const decryptedData = await decryptData(fileData);

      const decryptedBlob = new Blob([decryptedData], { type: file.type });
      const decryptedFileName = file.name.replace('.encrypted', '');
      downloadBlob(decryptedBlob, decryptedFileName);

      document.getElementById('status').innerText = "Decryption complete!";
    }

    function readFile(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsArrayBuffer(file);
      });
    }

    async function encryptData(data) {
      const encoder = new TextEncoder();
      const passwordData = encoder.encode(password);

      const passwordKey = await crypto.subtle.digest('SHA-256', passwordData);

      const key = await crypto.subtle.importKey(
        'raw',
        passwordKey,
        'AES-CBC',
        false,
        ['encrypt']
      );

      const iv = crypto.getRandomValues(new Uint8Array(16));
      const encryptedData = await crypto.subtle.encrypt(
        { name: 'AES-CBC', iv },
        key,
        data
      );

      const result = new Uint8Array(iv.byteLength + encryptedData.byteLength);
      result.set(iv, 0);
      result.set(new Uint8Array(encryptedData), iv.byteLength);

      return result;
    }

    async function decryptData(data) {
      const encoder = new TextEncoder();
      const passwordData = encoder.encode(password);

      const passwordKey = await crypto.subtle.digest('SHA-256', passwordData);

      const key = await crypto.subtle.importKey(
        'raw',
        passwordKey,
        'AES-CBC',
        false,
        ['decrypt']
      );

      const iv = data.slice(0, 16);
      const encryptedData = data.slice(16);

      const decryptedData = await crypto.subtle.decrypt(
        { name: 'AES-CBC', iv },
        key,
        encryptedData
      );

      return decryptedData;
    }

    function downloadBlob(blob, fileName) {
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = fileName;
      link.style.display = 'none';
      document.body.appendChild(link);
      link.click();
      URL.revokeObjectURL(url);
      document.body.removeChild(link);
    }
  </script>
</body>
</html>